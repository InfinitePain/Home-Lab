# yaml-language-server: $schema=https://goauthentik.io/blueprints/schema.json
version: 1
metadata:
  name: password-and-mfa-strict-authentication
context: {}
entries:
  - attrs:
      authentication: none
      compatibility_mode: true
      denied_action: message_continue
      designation: authentication
      layout: stacked
      name: Password and MFA Strict Authentication
      policy_engine_mode: any
      title: Welcome to Authentik!
    conditions: []
    identifiers:
      pk: 5cbc9933-0c8a-4273-958c-4d6cb4e89612
      slug: password-and-mfa-strict-authentication
    model: authentik_flows.flow
    state: created

  - attrs:
      expression: "flow_plan = request.context.get(\"flow_plan\")\nif not flow_plan:\n\
        \    return True\n# If the user does not have a backend attached to it, they\
        \ haven't\n# been authenticated yet and we need the password stage\nreturn not\
        \ hasattr(flow_plan.context.get(\"pending_user\"), \"backend\")"
      name: default-authentication-flow-password-stage
    conditions: []
    identifiers:
      pk: d7dd02ff-47af-408d-9047-3288c8541a06
    model: authentik_policies_expression.expressionpolicy
    state: created

  - attrs:
      check_ip: true
      name: Reputation Policy
      threshold: -5
    conditions: []
    identifiers:
      pk: d1bde141-9dcc-470e-97d2-ba05a8f596a0
    model: authentik_policies_reputation.reputationpolicy
    state: created

  - attrs:
      backends:
      - authentik.core.auth.InbuiltBackend
      - authentik.core.auth.TokenBackend
      - authentik.sources.ldap.auth.LDAPBackend
      configure_flow: f1e54046-b6a0-46e5-b843-9448fc6f8cc7
      failed_attempts_before_cancel: 3
    conditions: []
    identifiers:
      name: default-authentication-password
      pk: e6a5e130-c364-4ff2-93eb-df9dc8e1efa9
    model: authentik_stages_password.passwordstage
    state: created

  - attrs:
      case_insensitive_matching: true
      pretend_user_exists: true
      show_matched_user: true
      user_fields:
      - email
      - username
    conditions: []
    identifiers:
      name: default-authentication-identification
      pk: 9b72014d-1bc2-41b7-bbc2-0a2c4e86fdde
    model: authentik_stages_identification.identificationstage
    state: created

  - attrs:
      geoip_binding: no_binding
      network_binding: no_binding
      remember_me_offset: seconds=0
      session_duration: seconds=0
    conditions: []
    identifiers:
      name: default-authentication-login
      pk: 86bbb0b2-b307-41b3-92bb-0d077e58a576
    model: authentik_stages_user_login.userloginstage
    state: created

  - attrs:
      device_classes:
      - static
      - totp
      - webauthn
      last_auth_threshold: seconds=0
      not_configured_action: deny
      webauthn_user_verification: preferred
    conditions: []
    identifiers:
      name: TOTP / WebAuthn Validation Deny Stage
      pk: 56975b8a-a3fd-47b3-a462-2141c5cde463
    model: authentik_stages_authenticator_validate.authenticatorvalidatestage
    state: created

  - attrs:
      invalid_response_action: retry
      policy_engine_mode: any
      re_evaluate_policies: true
    conditions: []
    identifiers:
      order: 10
      pk: 746180b4-895b-48ac-8f14-61c1e87460c9
      stage: 9b72014d-1bc2-41b7-bbc2-0a2c4e86fdde
      target: 5cbc9933-0c8a-4273-958c-4d6cb4e89612
    model: authentik_flows.flowstagebinding
    state: created

  - attrs:
      invalid_response_action: retry
      policy_engine_mode: any
      re_evaluate_policies: true
    conditions: []
    identifiers:
      order: 20
      pk: e8ef3bbb-fb2d-43b0-a9db-2922f6c6af01
      stage: e6a5e130-c364-4ff2-93eb-df9dc8e1efa9
      target: 5cbc9933-0c8a-4273-958c-4d6cb4e89612
    model: authentik_flows.flowstagebinding
    state: created

  - attrs:
      invalid_response_action: retry
      policy_engine_mode: any
      re_evaluate_policies: true
    conditions: []
    identifiers:
      order: 30
      pk: 9a020cf7-650a-47e2-b1d8-b816873e2758
      stage: 56975b8a-a3fd-47b3-a462-2141c5cde463
      target: 5cbc9933-0c8a-4273-958c-4d6cb4e89612
    model: authentik_flows.flowstagebinding
    state: created

  - attrs:
      invalid_response_action: retry
      policy_engine_mode: any
      re_evaluate_policies: true
    conditions: []
    identifiers:
      order: 100
      pk: db09a428-ba39-4f9b-ba80-e22aa91f6642
      stage: 86bbb0b2-b307-41b3-92bb-0d077e58a576
      target: 5cbc9933-0c8a-4273-958c-4d6cb4e89612
    model: authentik_flows.flowstagebinding
    state: created

  - attrs:
      enabled: true
      timeout: 30
    conditions: []
    identifiers:
      order: 10
      pk: 949333c4-fa1a-4185-81bb-ea9160d09051
      policy: d7dd02ff-47af-408d-9047-3288c8541a06
      target: e8ef3bbb-fb2d-43b0-a9db-2922f6c6af01
    model: authentik_policies.policybinding
    state: created

  - attrs:
      enabled: true
      group: 7155b346-321b-43c7-a785-03297ea06c46
      negate: true
      timeout: 30
    conditions: []
    identifiers:
      order: 0
      pk: da491881-8171-4031-82cb-18b854748daa
      target: 9a020cf7-650a-47e2-b1d8-b816873e2758
    model: authentik_policies.policybinding
    state: created

  - attrs:
      enabled: true
      negate: true
      timeout: 30
    conditions: []
    identifiers:
      order: 0
      pk: acc74b76-9ca7-4842-a2cc-533d4b324b45
      policy: d1bde141-9dcc-470e-97d2-ba05a8f596a0
      target: 5cbc9933-0c8a-4273-958c-4d6cb4e89612
    model: authentik_policies.policybinding
    state: created
